<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>App Request Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #2D7FF9;
            --primary-light: #5A9DFF;
            --primary-dark: #0D5ED6;
            --secondary: #8C52FF;
            --accent: #FF5E8A;
            --background: #0A0F1E;
            --card-bg: rgba(255, 255, 255, 0.08);
            --surface: rgba(255, 255, 255, 0.12);
            --text: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --success: #00E1A0;
            --warning: #FFB547;
            --error: #FF5E7D;
            --sidebar-width: 250px;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
            position: relative;
            display: flex;
        }

        /* Liquid Blob Background */
        .liquid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .liquid-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.15;
            animation: float 20s infinite ease-in-out;
        }

        .blob-1 {
            width: 600px;
            height: 600px;
            background: var(--primary);
            top: -200px;
            right: -100px;
            animation-delay: 0s;
        }

        .blob-2 {
            width: 500px;
            height: 500px;
            background: var(--secondary);
            bottom: -150px;
            left: -100px;
            animation-delay: -5s;
        }

        .blob-3 {
            width: 300px;
            height: 300px;
            background: var(--accent);
            top: 40%;
            right: 20%;
            animation-delay: -10s;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) scale(1);
            }
            25% {
                transform: translate(5%, 5%) scale(1.05);
            }
            50% {
                transform: translate(0, 10%) scale(0.95);
            }
            75% {
                transform: translate(-5%, 5%) scale(1.05);
            }
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 10;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
        }

        .sidebar-logo i {
            margin-right: 0.75rem;
            color: var(--primary);
        }

        .sidebar-menu {
            list-style: none;
            margin-bottom: 2rem;
        }

        .sidebar-menu-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .sidebar-menu-item {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: var(--text);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .sidebar-menu-link:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu-link.active {
            background: var(--primary);
            color: white;
        }

        .sidebar-menu-link i {
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 1.5rem;
            left: 1.5rem;
            right: 1.5rem;
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
        }

        .sidebar-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .sidebar-user-info {
            flex: 1;
        }

        .sidebar-user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .sidebar-user-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .sidebar-user-actions {
            margin-left: 0.5rem;
        }

        .sidebar-user-actions button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .sidebar-user-actions button:hover {
            color: var(--text);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 2rem;
            max-width: 100%;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        /* Search Bar */
        .search-bar {
            position: relative;
            width: 300px;
        }

        .search-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: var(--text);
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 127, 249, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Card Styles */
        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .stat-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-change {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--error);
        }

        .stat-change i {
            margin-right: 0.25rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 4px;
            position: relative;
            margin-bottom: 1.5rem;
            width: fit-content;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            position: relative;
            z-index: 2;
            transition: color 0.3s ease;
            border-radius: 8px;
            font-weight: 500;
        }

        .tab.active {
            color: var(--background);
        }

        .tab-indicator {
            position: absolute;
            height: calc(100% - 8px);
            background: var(--primary);
            border-radius: 6px;
            top: 4px;
            left: 4px;
            transition: all 0.3s ease;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table th {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tbody tr {
            transition: background 0.3s ease;
        }

        .table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-badge.pending {
            background: rgba(255, 181, 71, 0.2);
            color: var(--warning);
        }

        .status-badge.in-progress {
            background: rgba(45, 127, 249, 0.2);
            color: var(--primary);
        }

        .status-badge.completed {
            background: rgba(0, 225, 160, 0.2);
            color: var(--success);
        }

        .status-badge.rejected {
            background: rgba(255, 94, 125, 0.2);
            color: var(--error);
        }

        /* Action Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 127, 249, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon.view {
            background: rgba(45, 127, 249, 0.2);
            color: var(--primary);
        }

        .btn-icon.edit {
            background: rgba(0, 225, 160, 0.2);
            color: var(--success);
        }

        .btn-icon.delete {
            background: rgba(255, 94, 125, 0.2);
            color: var(--error);
        }

        .btn-icon:hover {
            transform: translateY(-2px);
        }

        /* Pagination */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .pagination-item {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .pagination-item.active {
            background: var(--primary);
            color: white;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 30, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: linear-gradient(135deg, rgba(45, 127, 249, 0.2), rgba(140, 82, 255, 0.2));
            border-radius: 24px;
            padding: 24px;
            max-width: 90%;
            width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--text);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Detail List */
        .detail-list {
            margin-bottom: 1.5rem;
        }

        .detail-item {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 1rem;
        }

        .detail-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .detail-label {
            width: 150px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .detail-value {
            flex: 1;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: var(--text);
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 127, 249, 0.2);
        }

        .form-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            color: var(--text);
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(45, 127, 249, 0.2);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            right: 20px;
            bottom: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            color: var(--text);
            font-size: 0.9rem;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease-in-out;
            max-width: 350px;
            display: flex;
            align-items: center;
            border-left: 4px solid var(--primary);
            opacity: 0;
            visibility: hidden;
            transform: translateX(50px);
        }

        .toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--error);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast-icon {
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--error);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
        }

        .empty-icon {
            font-size: 3rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .empty-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .empty-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Mobile Sidebar Toggle */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            z-index: 100;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .sidebar-toggle {
                display: flex;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .header-actions {
                width: 100%;
            }

            .search-bar {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- Liquid Blob Background -->
    <div class="liquid-bg">
        <div class="liquid-blob blob-1"></div>
        <div class="liquid-blob blob-2"></div>
        <div class="liquid-blob blob-3"></div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="width: 100%;">
        <!-- Mobile Sidebar Toggle -->
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar -->
           <div class="sidebar-menu">
        <div class="menu-label">Main</div>
        <a href="admin.html" class="menu-item">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="overviewA.html" class="menu-item">
            <i class="fas fa-chart-line"></i>
            <span>Overview</span>
        </a>
        <a href="userA.html" class="menu-item">
            <i class="fas fa-users"></i>
            <span>Users</span>
        </a>
        
        <div class="menu-label">Management</div>
        <a href="dataA.html" class="menu-item">
            <i class="fas fa-wifi"></i>
            <span>Data</span>
        </a>
        <a href="storeA.html" class="menu-item">
            <i class="fas fa-store"></i>
            <span>Store</span>
        </a>
        <a href="requestA.html" class="menu-item">
            <i class="fas fa-clipboard-list"></i>
            <span>Requests</span>
        </a>
        <a href="reviewA.html" class="menu-item">
            <i class="fas fa-star"></i>
            <span>Reviews</span>
        </a>
        <a href="topupA.html" class="menu-item">
            <i class="fas fa-gamepad"></i>
            <span>Game Top-up</span>
        </a>
        <a href="templateA.html" class="menu-item">
            <i class="fas fa-file-alt"></i>
            <span>Templates</span>
        </a>
        
        <div class="menu-label">Settings</div>
        <a href="settingsA.html" class="menu-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </a>
        <a href="#" class="menu-item" id="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
        </a>
    </div>
</div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="content-section">
                <div class="header">
                    <h1 class="header-title">Dashboard</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" placeholder="Search requests...">
                        </div>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Total Requests</div>
                        <div class="stat-value" id="totalRequests">0</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>12% from last week</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-title">Pending Requests</div>
                        <div class="stat-value" id="pendingRequests">0</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>5% from last week</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-title">In Progress</div>
                        <div class="stat-value" id="inProgressRequests">0</div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i>
                            <span>3% from last week</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-title">Completed</div>
                        <div class="stat-value" id="completedRequests">0</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>8% from last week</span>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Requests -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Recent Requests</div>
                        <div class="card-actions">
                            <button class="btn btn-outline" id="refreshRequests">
                                <i class="fas fa-sync-alt"></i>
                                <span>Refresh</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>App Name</th>
                                    <th>Type</th>
                                    <th>Requester</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentRequestsTable">
                                <!-- Table rows will be added dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- App Requests Section -->
            <div id="appRequestsSection" class="content-section" style="display: none;">
                <div class="header">
                    <h1 class="header-title">App Requests</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="appRequestSearch" placeholder="Search app requests...">
                        </div>
                    </div>
                </div>
                
                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-status="all">All</div>
                    <div class="tab" data-status="pending">Pending</div>
                    <div class="tab" data-status="in-progress">In Progress</div>
                    <div class="tab" data-status="completed">Completed</div>
                    <div class="tab" data-status="rejected">Rejected</div>
                    <div class="tab-indicator" style="width: 60px;"></div>
                </div>
                
                <!-- App Requests Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>App Name</th>
                                <th>Type</th>
                                <th>Requester</th>
                                <th>Contact</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="appRequestsTable">
                            <!-- Table rows will be added dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Empty State (will be shown when there are no requests) -->
                <div class="empty-state" id="appRequestsEmpty" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3 class="empty-title">No App Requests Found</h3>
                    <p class="empty-description">There are no app requests matching your filters.</p>
                </div>
                
                <!-- Loading Spinner -->
                <div class="loading-spinner" id="appRequestsLoading">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <!-- Telegram Requests Section -->
            <div id="telegramRequestsSection" class="content-section" style="display: none;">
                <div class="header">
                    <h1 class="header-title">Telegram Bot Requests</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="telegramRequestSearch" placeholder="Search telegram requests...">
                        </div>
                    </div>
                </div>
                
                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-status="all">All</div>
                    <div class="tab" data-status="pending">Pending</div>
                    <div class="tab" data-status="in-progress">In Progress</div>
                    <div class="tab" data-status="completed">Completed</div>
                    <div class="tab" data-status="rejected">Rejected</div>
                    <div class="tab-indicator" style="width: 60px;"></div>
                </div>
                
                <!-- Telegram Requests Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Bot Type</th>
                                <th>Requester</th>
                                <th>Contact</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="telegramRequestsTable">
                            <!-- Table rows will be added dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Empty State (will be shown when there are no requests) -->
                <div class="empty-state" id="telegramRequestsEmpty" style="display: none;">
                    <div class="empty-icon">
                        <i class="fab fa-telegram"></i>
                    </div>
                    <h3 class="empty-title">No Telegram Bot Requests Found</h3>
                    <p class="empty-description">There are no telegram bot requests matching your filters.</p>
                </div>
                
                <!-- Loading Spinner -->
                <div class="loading-spinner" id="telegramRequestsLoading">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <!-- Custom Requests Section -->
            <div id="customRequestsSection" class="content-section" style="display: none;">
                <div class="header">
                    <h1 class="header-title">Custom Requests</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="customRequestSearch" placeholder="Search custom requests...">
                        </div>
                    </div>
                </div>
                
                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-status="all">All</div>
                    <div class="tab" data-status="pending">Pending</div>
                    <div class="tab" data-status="in-progress">In Progress</div>
                    <div class="tab" data-status="completed">Completed</div>
                    <div class="tab" data-status="rejected">Rejected</div>
                    <div class="tab-indicator" style="width: 60px;"></div>
                </div>
                
                <!-- Custom Requests Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Request Type</th>
                                <th>Requester</th>
                                <th>Contact</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customRequestsTable">
                            <!-- Table rows will be added dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Empty State (will be shown when there are no requests) -->
                <div class="empty-state" id="customRequestsEmpty" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <h3 class="empty-title">No Custom Requests Found</h3>
                    <p class="empty-description">There are no custom requests matching your filters.</p>
                </div>
                
                <!-- Loading Spinner -->
                <div class="loading-spinner" id="customRequestsLoading">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <!-- Users Section -->
            <div id="usersSection" class="content-section" style="display: none;">
                <div class="header">
                    <h1 class="header-title">Users</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="userSearch" placeholder="Search users...">
                        </div>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Requests</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Table rows will be added dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Empty State (will be shown when there are no users) -->
                <div class="empty-state" id="usersEmpty" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="empty-title">No Users Found</h3>
                    <p class="empty-description">There are no users matching your search.</p>
                </div>
                
                <!-- Loading Spinner -->
                <div class="loading-spinner" id="usersLoading">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div id="settingsSection" class="content-section" style="display: none;">
                <div class="header">
                    <h1 class="header-title">Settings</h1>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Admin Settings</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminEmail" class="form-label">Admin Email</label>
                        <input type="email" id="adminEmail" class="form-input" placeholder="Enter admin email" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminName" class="form-label">Admin Name</label>
                        <input type="text" id="adminName" class="form-input" placeholder="Enter admin name">
                    </div>
                    
                    <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Request Detail Modal -->
    <div class="modal-overlay" id="requestDetailModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Request Details</h2>
                <button class="modal-close" id="closeDetailModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="requestDetailContent">
                <!-- Request details will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeDetailBtn">Close</button>
                <button class="btn btn-primary" id="updateStatusBtn">Update Status</button>
            </div>
        </div>
    </div>
    
    <!-- Update Status Modal -->
    <div class="modal-overlay" id="updateStatusModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Update Request Status</h2>
                <button class="modal-close" id="closeStatusModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="statusSelect" class="form-label">Status</label>
                    <select id="statusSelect" class="form-select">
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="statusNote" class="form-label">Note (optional)</label>
                    <textarea id="statusNote" class="form-input form-textarea" placeholder="Add a note about this status update"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelStatusBtn">Cancel</button>
                <button class="btn btn-primary" id="saveStatusBtn">Save Status</button>
            </div>
        </div>
    </div>
    
    <!-- Contact User Modal -->
    <div class="modal-overlay" id="contactUserModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Contact User</h2>
                <button class="modal-close" id="closeContactModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="contactUserContent">
                <!-- Contact options will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeContactBtn">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="toast-icon" id="toastIcon"></div>
        <div id="toastMessage"></div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDeu5aIuvz107y9FDyU3quV_BT_4Cgob10",
            authDomain: "veltrawave-vtu.firebaseapp.com",
            projectId: "veltrawave-vtu",
            storageBucket: "veltrawave-vtu.firebasestorage.app",
            messagingSenderId: "431351611304",
            appId: "1:431351611304:web:7381dd659920f9f325a79d",
            measurementId: "G-HRHN8GJCR3"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // DOM Elements
        const adminDashboard = document.getElementById('adminDashboard');
        const sidebarLinks = document.querySelectorAll('.sidebar-menu-link');
        const contentSections = document.querySelectorAll('.content-section');
        const logoutBtn = document.getElementById('logoutBtn');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const userInitials = document.getElementById('userInitials');
        const userName = document.getElementById('userName');
        
        // Request Detail Modal Elements
        const requestDetailModal = document.getElementById('requestDetailModal');
        const closeDetailModal = document.getElementById('closeDetailModal');
        const closeDetailBtn = document.getElementById('closeDetailBtn');
        const requestDetailContent = document.getElementById('requestDetailContent');
        const updateStatusBtn = document.getElementById('updateStatusBtn');
        
        // Update Status Modal Elements
        const updateStatusModal = document.getElementById('updateStatusModal');
        const closeStatusModal = document.getElementById('closeStatusModal');
        const cancelStatusBtn = document.getElementById('cancelStatusBtn');
        const saveStatusBtn = document.getElementById('saveStatusBtn');
        const statusSelect = document.getElementById('statusSelect');
        const statusNote = document.getElementById('statusNote');
        
        // Contact User Modal Elements
        const contactUserModal = document.getElementById('contactUserModal');
        const closeContactModal = document.getElementById('closeContactModal');
        const closeContactBtn = document.getElementById('closeContactBtn');
        const contactUserContent = document.getElementById('contactUserContent');
        
        // Toast Elements
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const toastIcon = document.getElementById('toastIcon');
        
        // Table Elements
        const recentRequestsTable = document.getElementById('recentRequestsTable');
        const appRequestsTable = document.getElementById('appRequestsTable');
        const telegramRequestsTable = document.getElementById('telegramRequestsTable');
        const customRequestsTable = document.getElementById('customRequestsTable');
        const usersTable = document.getElementById('usersTable');
        
        // Loading Elements
        const appRequestsLoading = document.getElementById('appRequestsLoading');
        const telegramRequestsLoading = document.getElementById('telegramRequestsLoading');
        const customRequestsLoading = document.getElementById('customRequestsLoading');
        const usersLoading = document.getElementById('usersLoading');
        
        // Empty State Elements
        const appRequestsEmpty = document.getElementById('appRequestsEmpty');
        const telegramRequestsEmpty = document.getElementById('telegramRequestsEmpty');
        const customRequestsEmpty = document.getElementById('customRequestsEmpty');
        const usersEmpty = document.getElementById('usersEmpty');
        
        // Stats Elements
        const totalRequestsElement = document.getElementById('totalRequests');
        const pendingRequestsElement = document.getElementById('pendingRequests');
        const inProgressRequestsElement = document.getElementById('inProgressRequests');
        const completedRequestsElement = document.getElementById('completedRequests');
        
        // Refresh Button
        const refreshRequests = document.getElementById('refreshRequests');
        
        // Tab Elements
        const tabs = document.querySelectorAll('.tab');
        const tabIndicator = document.querySelector('.tab-indicator');
        
        // State Variables
        let currentUser = null;
        let currentSection = 'dashboard';
        let currentRequestId = null;
        let currentRequest = null;
        let currentTab = 'all';
        let appRequests = [];
        let telegramRequests = [];
        let customRequests = [];
        let users = [];
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Admin page initializing...");
            
            // Check if user is logged in
            auth.onAuthStateChanged(user => {
                console.log("Auth state changed:", user ? user.uid : "No user");
                
                if (user) {
                    // Check if user is an admin
                    checkAdminStatus(user);
                } else {
                    // Redirect to login page
                    window.location.href = "/login.html";
                }
            });
            
            // Set up event listeners
            setupEventListeners();
        });
        
        // Check if user is an admin
        async function checkAdminStatus(user) {
            try {
                const adminDoc = await db.collection('admins').doc(user.uid).get();
                
                if (adminDoc.exists) {
                    // User is an admin
                    currentUser = user;
                    showAdminDashboard(user);
                    loadAdminData(user);
                } else {
                    // User is not an admin
                    showToast('You do not have admin privileges', 'error');
                    auth.signOut();
                    window.location.href = "/login.html";
                }
            } catch (error) {
                console.error('Error checking admin status:', error);
                showToast('Error checking admin status', 'error');
                auth.signOut();
                window.location.href = "/login.html";
            }
        }
        
        // Show admin dashboard
        function showAdminDashboard(user) {
            // Update user info
            updateUserInfo(user);
            
            // Load dashboard data
            loadDashboardData();
        }
        
        // Update user info in sidebar
        function updateUserInfo(user) {
            // Set user initials
            const email = user.email || '';
            const initials = email.charAt(0).toUpperCase();
            userInitials.textContent = initials;
            
            // Set user name
            userName.textContent = user.displayName || email;
            
            // Update admin settings
            document.getElementById('adminEmail').value = email;
            document.getElementById('adminName').value = user.displayName || '';
        }
        
        // Load admin data
        async function loadAdminData(user) {
            try {
                const adminDoc = await db.collection('admins').doc(user.uid).get();
                
                if (adminDoc.exists) {
                    const adminData = adminDoc.data();
                    
                    // Update user name if available
                    if (adminData.name) {
                        userName.textContent = adminData.name;
                        document.getElementById('adminName').value = adminData.name;
                    }
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load app requests stats
                await loadAppRequestsStats();
                
                // Load recent requests
                await loadRecentRequests();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Error loading dashboard data', 'error');
            }
        }
        
        // Load app requests stats
        async function loadAppRequestsStats() {
            try {
                // Get app requests
                const appRequestsSnapshot = await db.collection('appRequests').get();
                
                // Get custom requests
                const customRequestsSnapshot = await db.collection('customRequests').get();
                
                let total = appRequestsSnapshot.size + customRequestsSnapshot.size;
                let pending = 0;
                let inProgress = 0;
                let completed = 0;
                
                // Count app requests by status
                appRequestsSnapshot.forEach(doc => {
                    const request = doc.data();
                    
                    if (request.status === 'pending') {
                        pending++;
                    } else if (request.status === 'in-progress') {
                        inProgress++;
                    } else if (request.status === 'completed') {
                        completed++;
                    }
                });
                
                // Count custom requests by status
                customRequestsSnapshot.forEach(doc => {
                    const request = doc.data();
                    
                    if (request.status === 'pending') {
                        pending++;
                    } else if (request.status === 'in-progress') {
                        inProgress++;
                    } else if (request.status === 'completed') {
                        completed++;
                    }
                });
                
                // Update stats
                totalRequestsElement.textContent = total;
                pendingRequestsElement.textContent = pending;
                inProgressRequestsElement.textContent = inProgress;
                completedRequestsElement.textContent = completed;
            } catch (error) {
                console.error('Error loading app requests stats:', error);
                throw error;
            }
        }
        
        // Load recent requests
        async function loadRecentRequests() {
            try {
                // Get app requests
                const appRequestsSnapshot = await db.collection('appRequests')
                    .orderBy('timestamp', 'desc')
                    .limit(5)
                    .get();
                
                // Get custom requests
                const customRequestsSnapshot = await db.collection('customRequests')
                    .orderBy('timestamp', 'desc')
                    .limit(5)
                    .get();
                
                // Combine requests
                const combinedRequests = [];
                
                appRequestsSnapshot.forEach(doc => {
                    const request = doc.data();
                    request.id = doc.id;
                    request.collection = 'appRequests';
                    combinedRequests.push(request);
                });
                
                customRequestsSnapshot.forEach(doc => {
                    const request = doc.data();
                    request.id = doc.id;
                    request.collection = 'customRequests';
                    combinedRequests.push(request);
                });
                
                // Sort by timestamp
                combinedRequests.sort((a, b) => {
                    const timestampA = a.timestamp ? a.timestamp.toDate() : new Date(0);
                    const timestampB = b.timestamp ? b.timestamp.toDate() : new Date(0);
                    return timestampB - timestampA;
                });
                
                // Limit to 10 most recent
                const recentRequests = combinedRequests.slice(0, 10);
                
                recentRequestsTable.innerHTML = '';
                
                if (recentRequests.length === 0) {
                    recentRequestsTable.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center;">No recent requests found</td>
                        </tr>
                    `;
                    return;
                }
                
                recentRequests.forEach(request => {
                    // Format date
                    const date = request.timestamp ? new Date(request.timestamp.toDate()) : new Date();
                    const formattedDate = date.toLocaleDateString();
                    
                    // Create table row
                    const row = document.createElement('tr');
                    
                    // Determine status class
                    let statusClass = 'pending';
                    if (request.status === 'in-progress') {
                        statusClass = 'in-progress';
                    } else if (request.status === 'completed') {
                        statusClass = 'completed';
                    } else if (request.status === 'rejected') {
                        statusClass = 'rejected';
                    }
                    
                    // Determine request type
                    let requestType = request.appType || 'Custom';
                    
                    row.innerHTML = `
                        <td>${request.id.substring(0, 8)}</td>
                        <td>${request.appName || request.title || 'Unnamed Request'}</td>
                        <td>${requestType}</td>
                        <td>${request.fullName || 'Unknown'}</td>
                        <td>${formattedDate}</td>
                        <td><span class="status-badge ${statusClass}">${request.status || 'pending'}</span></td>
                        <td>
                            <button class="btn-icon view" data-id="${request.id}" data-collection="${request.collection}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    
                    // Add event listener to view button
                    row.querySelector('.btn-icon.view').addEventListener('click', (e) => {
                        const requestId = e.currentTarget.dataset.id;
                        const collection = e.currentTarget.dataset.collection;
                        viewRequestDetails(requestId, collection);
                    });
                    
                    recentRequestsTable.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading recent requests:', error);
                throw error;
            }
        }
        
        // Load app requests
        async function loadAppRequests(status = 'all') {
            try {
                appRequestsLoading.style.display = 'flex';
                appRequestsEmpty.style.display = 'none';
                appRequestsTable.innerHTML = '';
                
                let query = db.collection('appRequests').orderBy('timestamp', 'desc');
                
                if (status !== 'all') {
                    query = query.where('status', '==', status);
                }
                
                const requestsSnapshot = await query.get();
                
                appRequestsLoading.style.display = 'none';
                
                if (requestsSnapshot.empty) {
                    appRequestsEmpty.style.display = 'flex';
                    return;
                }
                
                appRequests = [];
                
                requestsSnapshot.forEach(doc => {
                    const request = doc.data();
                    request.id = doc.id;
                    request.collection = 'appRequests';
                    appRequests.push(request);
                });
                
                renderAppRequests(appRequests);
            } catch (error) {
                console.error('Error loading app requests:', error);
                appRequestsLoading.style.display = 'none';
                showToast('Error loading app requests', 'error');
            }
        }
        
        // Render app requests
        function renderAppRequests(requests) {
            appRequestsTable.innerHTML = '';
            
            if (requests.length === 0) {
                appRequestsEmpty.style.display = 'flex';
                return;
            }
            
            appRequestsEmpty.style.display = 'none';
            
            requests.forEach(request => {
                // Format date
                const date = request.timestamp ? new Date(request.timestamp.toDate()) : new Date();
                const formattedDate = date.toLocaleDateString();
                
                // Determine contact method
                let contactInfo = '';
                if (request.contactMethod === 'whatsapp' && request.whatsappNumber) {
                    contactInfo = `<i class="fab fa-whatsapp"></i> ${request.whatsappNumber}`;
                } else if (request.contactMethod === 'telegram' && request.telegramUsername) {
                    contactInfo = `<i class="fab fa-telegram"></i> ${request.telegramUsername}`;
                } else if (request.contactMethod === 'facebook' && request.facebookProfile) {
                    contactInfo = `<i class="fab fa-facebook"></i> Profile Link`;
                } else if (request.email) {
                    contactInfo = `<i class="fas fa-envelope"></i> ${request.email}`;
                }
                
                // Create table row
                const row = document.createElement('tr');
                
                // Determine status class
                let statusClass = 'pending';
                if (request.status === 'in-progress') {
                    statusClass = 'in-progress';
                } else if (request.status === 'completed') {
                    statusClass = 'completed';
                } else if (request.status === 'rejected') {
                    statusClass = 'rejected';
                }
                
                row.innerHTML = `
                    <td>${request.id.substring(0, 8)}</td>
                    <td>${request.appName || 'Unnamed App'}</td>
                    <td>${request.appType || 'Unknown'}</td>
                    <td>${request.fullName || 'Unknown'}</td>
                    <td>${contactInfo}</td>
                    <td>${formattedDate}</td>
                    <td><span class="status-badge ${statusClass}">${request.status || 'pending'}</span></td>
                    <td>
                        <button class="btn-icon view" data-id="${request.id}" data-collection="appRequests">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-icon edit" data-id="${request.id}" data-collection="appRequests">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                
                // Add event listeners to buttons
                row.querySelector('.btn-icon.view').addEventListener('click', (e) => {
                    const requestId = e.currentTarget.dataset.id;
                    const collection = e.currentTarget.dataset.collection;
                    viewRequestDetails(requestId, collection);
                });
                
                row.querySelector('.btn-icon.edit').addEventListener('click', (e) => {
                    const requestId = e.currentTarget.dataset.id;
                    const collection = e.currentTarget.dataset.collection;
                    showUpdateStatusModal(requestId, collection);
                });
                
                appRequestsTable.appendChild(row);
            });
        }
        
        // Load telegram requests
        async function loadTelegramRequests(status = 'all') {
            try {
                telegramRequestsLoading.style.display = 'flex';
                telegramRequestsEmpty.style.display = 'none';
                telegramRequestsTable.innerHTML = '';
                
                let query = db.collection('appRequests')
                    .where('appType', '==', 'telegram')
                    .orderBy('timestamp', 'desc');
                
                if (status !== 'all') {
                    query = query.where('status', '==', status);
                }
                
                const requestsSnapshot = await query.get();
                
                telegramRequestsLoading.style.display = 'none';
                
                if (requestsSnapshot.empty) {
                    telegramRequestsEmpty.style.display = 'flex';
                    return;
                }
                
                telegramRequests = [];
                
                requestsSnapshot.forEach(doc => {
                    const request = doc.data();
                    request.id = doc.id;
                    request.collection = 'appRequests';
                    telegramRequests.push(request);
                });
                
                renderTelegramRequests(telegramRequests);
            } catch (error) {
                console.error('Error loading telegram requests:', error);
                telegramRequestsLoading.style.display = 'none';
                showToast('Error loading telegram requests', 'error');
            }
        }
        
        // Render telegram requests
        function renderTelegramRequests(requests) {
            telegramRequestsTable.innerHTML = '';
            
            if (requests.length === 0) {
                telegramRequestsEmpty.style.display = 'flex';
                return;
            }
            
            telegramRequestsEmpty.style.display = 'none';
            
            requests.forEach(request => {
                // Format date
                const date = request.timestamp ? new Date(request.timestamp.toDate()) : new Date();
                const formattedDate = date.toLocaleDateString();
                
                // Determine contact method
                let contactInfo = '';
                if (request.contactMethod === 'whatsapp' && request.whatsappNumber) {
                    contactInfo = `<i class="fab fa-whatsapp"></i> ${request.whatsappNumber}`;
                } else if (request.contactMethod === 'telegram' && request.telegramUsername) {
                    contactInfo = `<i class="fab fa-telegram"></i> ${request.telegramUsername}`;
                } else if (request.contactMethod === 'facebook' && request.facebookProfile) {
                    contactInfo = `<i class="fab fa-facebook"></i> Profile Link`;
                } else if (request.email) {
                    contactInfo = `<i class="fas fa-envelope"></i> ${request.email}`;
                }
                
                // Create table row
                const row = document.createElement('tr');
                
                // Determine status class
                let statusClass = 'pending';
                if (request.status === 'in-progress') {
                    statusClass = 'in-progress';
                } else if (request.status === 'completed') {
                    statusClass = 'completed';
                } else if (request.status === 'rejected') {
                    statusClass = 'rejected';
                }
                
                row.innerHTML = `
                    <td>${request.id.substring(0, 8)}</td>
                    <td>${request.telegramBotType || 'Not specified'}</td>
                    <td>${request.fullName || 'Unknown'}</td>
                    <td>${contactInfo}</td>
                    <td>${formattedDate}</td>
                    <td><span class="status-badge ${statusClass}">${request.status || 'pending'}</span></td>
                    <td>
                        <button class="btn-icon view" data-id="${request.id}" data-collection="appRequests">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-icon edit" data-id="${request.id}" data-collection="appRequests">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                
                // Add event listeners to buttons
                row.querySelector('.btn-icon.view').addEventListener('click', (e) => {
                    const requestId = e.currentTarget.dataset.id;
                    const collection = e.currentTarget.dataset.collection;
                    viewRequestDetails(requestId, collection);
                });
                
                row.querySelector('.btn-icon.edit').addEventListener('click', (e) => {
                    const requestId = e.currentTarget.dataset.id;
                    const collection = e.currentTarget.dataset.collection;
                    showUpdateStatusModal(requestId, collection);
                });
                
                telegramRequestsTable.appendChild(row);
            });
        }
        
        // Load custom requests
        async function loadCustomRequests(status = 'all') {
            try {
                customRequestsLoading.style.display = 'flex';
                customRequestsEmpty.style.display = 'none';
                customRequestsTable.innerHTML = '';
                
                let query = db.collection('customRequests').orderBy('timestamp', 'desc');
                
                if (status !== 'all') {
                    query = query.where('status', '==', status);
                }
                
                const requestsSnapshot = await query.get();
                
                customRequestsLoading.style.display = 'none';
                
                if (requestsSnapshot.empty) {
                    customRequestsEmpty.style.display = 'flex';
                    return;
                }
                
                customRequests = [];
                
                requestsSnapshot.forEach(doc => {
                    const request = doc.data();
                    request.id = doc.id;
                    request.collection = 'customRequests';
                    customRequests.push(request);
                });
                
                renderCustomRequests(customRequests);
            } catch (error) {
                console.error('Error loading custom requests:', error);
                customRequestsLoading.style.display = 'none';
                showToast('Error loading custom requests', 'error');
            }
        }
        
        // Render custom requests
        function renderCustomRequests(requests) {
            customRequestsTable.innerHTML = '';
            
            if (requests.length === 0) {
                customRequestsEmpty.style.display = 'flex';
                return;
            }
            
            customRequestsEmpty.style.display = 'none';
            
            requests.forEach(request => {
                // Format date
                const date = request.timestamp ? new Date(request.timestamp.toDate()) : new Date();
                const formattedDate = date.toLocaleDateString();
                
                // Determine contact method
                let contactInfo = '';
                if (request.contactMethod === 'whatsapp' && request.whatsappNumber) {
                    contactInfo = `<i class="fab fa-whatsapp"></i> ${request.whatsappNumber}`;
                } else if (request.contactMethod === 'telegram' && request.telegramUsername) {
                    contactInfo = `<i class="fab fa-telegram"></i> ${request.telegramUsername}`;
                } else if (request.contactMethod === 'facebook' && request.facebookProfile) {
                    contactInfo = `<i class="fab fa-facebook"></i> Profile Link`;
                } else if (request.email) {
                    contactInfo = `<i class="fas fa-envelope"></i> ${request.email}`;
                } else if (request.phone) {
                    contactInfo = `<i class="fas fa-phone"></i> ${request.phone}`;
                }
                
                // Create table row
                const row = document.createElement('tr');
                
                // Determine status class
                let statusClass = 'pending';
                if (request.status === 'in-progress') {
                    statusClass = 'in-progress';
                } else if (request.status === 'completed') {
                    statusClass = 'completed';
                } else if (request.status === 'rejected') {
                    statusClass = 'rejected';
                }
                
                row.innerHTML = `
                    <td>${request.id.substring(0, 8)}</td>
                    <td>${request.requestType || 'Custom'}</td>
                    <td>${request.fullName || request.name || 'Unknown'}</td>
                    <td>${contactInfo}</td>
                    <td>${formattedDate}</td>
                    <td><span class="status-badge ${statusClass}">${request.status || 'pending'}</span></td>
                    <td>
                        <button class="btn-icon view" data-id="${request.id}" data-collection="customRequests">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-icon edit" data-id="${request.id}" data-collection="customRequests">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                
                // Add event listeners to buttons
                row.querySelector('.btn-icon.view').addEventListener('click', (e) => {
                    const requestId = e.currentTarget.dataset.id;
                    const collection = e.currentTarget.dataset.collection;
                    viewRequestDetails(requestId, collection);
                });
                
                row.querySelector('.btn-icon.edit').addEventListener('click', (e) => {
                    const requestId = e.currentTarget.dataset.id;
                    const collection = e.currentTarget.dataset.collection;
                    showUpdateStatusModal(requestId, collection);
                });
                
                customRequestsTable.appendChild(row);
            });
        }
        
        // Load users
        async function loadUsers() {
            try {
                usersLoading.style.display = 'flex';
                usersEmpty.style.display = 'none';
                usersTable.innerHTML = '';
                
                const usersSnapshot = await db.collection('users').get();
                
                usersLoading.style.display = 'none';
                
                if (usersSnapshot.empty) {
                    usersEmpty.style.display = 'flex';
                    return;
                }
                
                users = [];
                
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    user.id = doc.id;
                    users.push(user);
                });
                
                renderUsers(users);
            } catch (error) {
                console.error('Error loading users:', error);
                usersLoading.style.display = 'none';
                showToast('Error loading users', 'error');
            }
        }
        
        // Render users
        function renderUsers(users) {
            usersTable.innerHTML = '';
            
            if (users.length === 0) {
                usersEmpty.style.display = 'flex';
                return;
            }
            
            usersEmpty.style.display = 'none';
            
            users.forEach(user => {
                // Create table row
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${user.user_id || user.id.substring(0, 8)}</td>
                    <td>${user.first_name || ''} ${user.last_name || ''}</td>
                    <td>${user.email || 'No email'}</td>
                    <td>${user.phone_number || 'No phone'}</td>
                    <td>0</td>
                    <td>
                        <button class="btn-icon view" data-id="${user.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                // Add event listener to view button
                row.querySelector('.btn-icon.view').addEventListener('click', () => {
                    viewUserDetails(user.id);
                });
                
                usersTable.appendChild(row);
            });
        }
        
        // View request details
        async function viewRequestDetails(requestId, collection) {
            try {
                currentRequestId = requestId;
                
                const requestDoc = await db.collection(collection).doc(requestId).get();
                
                if (!requestDoc.exists) {
                    showToast('Request not found', 'error');
                    return;
                }
                
                currentRequest = requestDoc.data();
                currentRequest.id = requestId;
                currentRequest.collection = collection;
                
                // Format date
                const date = currentRequest.timestamp ? new Date(currentRequest.timestamp.toDate()) : new Date();
                const formattedDate = date.toLocaleString();
                
                // Determine status class
                let statusClass = 'pending';
                if (currentRequest.status === 'in-progress') {
                    statusClass = 'in-progress';
                } else if (currentRequest.status === 'completed') {
                    statusClass = 'completed';
                } else if (currentRequest.status === 'rejected') {
                    statusClass = 'rejected';
                }
                
                // Build contact info
                let contactInfo = '';
                if (currentRequest.contactMethod === 'whatsapp' && currentRequest.whatsappNumber) {
                    contactInfo = `
                        <div class="detail-item">
                            <div class="detail-label">WhatsApp</div>
                            <div class="detail-value">
                                <a href="https://wa.me/${currentRequest.whatsappNumber.replace(/\D/g, '')}" target="_blank">
                                    ${currentRequest.whatsappNumber}
                                </a>
                            </div>
                        </div>
                    `;
                } else if (currentRequest.contactMethod === 'telegram' && currentRequest.telegramUsername) {
                    contactInfo = `
                        <div class="detail-item">
                            <div class="detail-label">Telegram</div>
                            <div class="detail-value">
                                <a href="https://t.me/${currentRequest.telegramUsername.replace('@', '')}" target="_blank">
                                    ${currentRequest.telegramUsername}
                                </a>
                            </div>
                        </div>
                    `;
                } else if (currentRequest.contactMethod === 'facebook' && currentRequest.facebookProfile) {
                    contactInfo = `
                        <div class="detail-item">
                            <div class="detail-label">Facebook</div>
                            <div class="detail-value">
                                <a href="${currentRequest.facebookProfile}" target="_blank">
                                    View Profile
                                </a>
                            </div>
                        </div>
                    `;
                } else if (currentRequest.phone) {
                    contactInfo = `
                        <div class="detail-item">
                            <div class="detail-label">Phone</div>
                            <div class="detail-value">
                                <a href="tel:${currentRequest.phone}">
                                    ${currentRequest.phone}
                                </a>
                            </div>
                        </div>
                    `;
                }
                
                if (currentRequest.email) {
                    contactInfo += `
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">
                                <a href="mailto:${currentRequest.email}">
                                    ${currentRequest.email}
                                </a>
                            </div>
                        </div>
                    `;
                }
                
                // Build request details HTML based on collection type
                let detailsHTML = '';
                
                if (collection === 'appRequests') {
                    // Build telegram specific info
                    let telegramInfo = '';
                    if (currentRequest.appType === 'telegram') {
                        telegramInfo = `
                            <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">Telegram Bot Details</h3>
                            <div class="detail-list">
                                <div class="detail-item">
                                    <div class="detail-label">Bot Type</div>
                                    <div class="detail-value">${currentRequest.telegramBotType || 'Not specified'}</div>
                                </div>
                                
                                <div class="detail-item">
                                    <div class="detail-label">Features</div>
                                    <div class="detail-value">${currentRequest.telegramFeatures ? currentRequest.telegramFeatures.join(', ') : 'None specified'}</div>
                                </div>
                            </div>
                        `;
                    }
                    
                    detailsHTML = `
                        <div class="detail-list">
                            <div class="detail-item">
                                <div class="detail-label">Request ID</div>
                                <div class="detail-value">${requestId}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Status</div>
                                <div class="detail-value">
                                    <span class="status-badge ${statusClass}">${currentRequest.status || 'pending'}</span>
                                </div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Date</div>
                                <div class="detail-value">${formattedDate}</div>
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">App Details</h3>
                        <div class="detail-list">
                            <div class="detail-item">
                                <div class="detail-label">App Name</div>
                                <div class="detail-value">${currentRequest.appName || 'Not specified'}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">App Type</div>
                                <div class="detail-value">${currentRequest.appType || 'Not specified'}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Description</div>
                                <div class="detail-value">${currentRequest.appDescription || 'Not provided'}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Features</div>
                                <div class="detail-value">${currentRequest.appFeatures || 'Not provided'}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Budget</div>
                                <div class="detail-value">${currentRequest.budget || 'Not specified'}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Timeline</div>
                                <div class="detail-value">${currentRequest.timeline || 'Not specified'}</div>
                            </div>
                        </div>
                        
                        ${telegramInfo}
                        
                        <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">Requester Information</h3>
                        <div class="detail-list">
                            <div class="detail-item">
                                <div class="detail-label">Name</div>
                                <div class="detail-value">${currentRequest.fullName || 'Not provided'}</div>
                            </div>
                            
                            ${contactInfo}
                            
                            <div class="detail-item">
                                <div class="detail-label">Additional Info</div>
                                <div class="detail-value">${currentRequest.additionalInfo || 'None provided'}</div>
                            </div>
                        </div>
                    `;
                } else if (collection === 'customRequests') {
                    // Custom request details
                    detailsHTML = `
                        <div class="detail-list">
                            <div class="detail-item">
                                <div class="detail-label">Request ID</div>
                                <div class="detail-value">${requestId}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Status</div>
                                <div class="detail-value">
                                    <span class="status-badge ${statusClass}">${currentRequest.status || 'pending'}</span>
                                </div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Date</div>
                                <div class="detail-value">${formattedDate}</div>
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">Request Details</h3>
                        <div class="detail-list">
                            <div class="detail-item">
                                <div class="detail-label">Request Type</div>
                                <div class="detail-value">${currentRequest.requestType || 'Custom'}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Title</div>
                                <div class="detail-value">${currentRequest.title || 'Not specified'}</div>
                            </div>
                            
                            <div class="detail-item">
                                <div class="detail-label">Description</div>
                                <div class="detail-value">${currentRequest.description || 'Not provided'}</div>
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">Requester Information</h3>
                        <div class="detail-list">
                            <div class="detail-item">
                                <div class="detail-label">Name</div>
                                <div class="detail-value">${currentRequest.fullName || currentRequest.name || 'Not provided'}</div>
                            </div>
                            
                            ${contactInfo}
                        </div>
                    `;
                }
                
                // Add contact button
                detailsHTML += `
                    <div style="margin-top: 1.5rem;">
                        <button class="btn btn-outline" id="contactUserBtn" style="margin-right: 0.5rem;">
                            <i class="fas fa-envelope"></i>
                            Contact User
                        </button>
                    </div>
                `;
                
                requestDetailContent.innerHTML = detailsHTML;
                
                // Add event listener to contact user button
                document.getElementById('contactUserBtn').addEventListener('click', () => {
                    showContactUserModal(currentRequest);
                });
                
                // Show modal
                requestDetailModal.classList.add('active');
            } catch (error) {
                console.error('Error viewing request details:', error);
                showToast('Error loading request details', 'error');
            }
        }
        
        // Show update status modal
        function showUpdateStatusModal(requestId, collection) {
            currentRequestId = requestId;
            
            // Find the request
            let request = null;
            
            if (collection === 'appRequests') {
                request = [...appRequests, ...telegramRequests].find(req => req.id === requestId);
            } else if (collection === 'customRequests') {
                request = customRequests.find(req => req.id === requestId);
            }
            
            if (request) {
                currentRequest = request;
                
                // Set current status
                statusSelect.value = request.status || 'pending';
                statusNote.value = '';
                
                // Show modal
                updateStatusModal.classList.add('active');
            } else {
                showToast('Request not found', 'error');
            }
        }
        
        // Show contact user modal
        function showContactUserModal(request) {
            // Build contact options
            let contactOptionsHTML = `
                <h3 style="margin-bottom: 1rem;">Contact Options for ${request.fullName || request.name || 'User'}</h3>
            `;
            
            if (request.contactMethod === 'whatsapp' && request.whatsappNumber) {
                contactOptionsHTML += `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem;">WhatsApp</h4>
                        <p>${request.whatsappNumber}</p>
                        <a href="https://wa.me/${request.whatsappNumber.replace(/\D/g, '')}" target="_blank" class="btn btn-primary" style="margin-top: 0.5rem;">
                            <i class="fab fa-whatsapp"></i>
                            Open WhatsApp
                        </a>
                    </div>
                `;
            }
            
            if (request.contactMethod === 'telegram' && request.telegramUsername) {
                contactOptionsHTML += `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem;">Telegram</h4>
                        <p>${request.telegramUsername}</p>
                        <a href="https://t.me/${request.telegramUsername.replace('@', '')}" target="_blank" class="btn btn-primary" style="margin-top: 0.5rem;">
                            <i class="fab fa-telegram"></i>
                            Open Telegram
                        </a>
                    </div>
                `;
            }
            
            if (request.contactMethod === 'facebook' && request.facebookProfile) {
                contactOptionsHTML += `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem;">Facebook</h4>
                        <a href="${request.facebookProfile}" target="_blank" class="btn btn-primary" style="margin-top: 0.5rem;">
                            <i class="fab fa-facebook"></i>
                            Open Facebook Profile
                        </a>
                    </div>
                `;
            }
            
            if (request.phone) {
                contactOptionsHTML += `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem;">Phone</h4>
                        <p>${request.phone}</p>
                        <a href="tel:${request.phone}" class="btn btn-primary" style="margin-top: 0.5rem;">
                            <i class="fas fa-phone"></i>
                            Call
                        </a>
                    </div>
                `;
            }
            
            if (request.email) {
                contactOptionsHTML += `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem;">Email</h4>
                        <p>${request.email}</p>
                        <a href="mailto:${request.email}" class="btn btn-primary" style="margin-top: 0.5rem;">
                            <i class="fas fa-envelope"></i>
                            Send Email
                        </a>
                    </div>
                `;
            }
            
            contactUserContent.innerHTML = contactOptionsHTML;
            
            // Show modal
            contactUserModal.classList.add('active');
        }
        
        // Update request status
        async function updateRequestStatus() {
            try {
                if (!currentRequestId || !currentRequest) {
                    showToast('No request selected', 'error');
                    return;
                }
                
                const status = statusSelect.value;
                const note = statusNote.value.trim();
                const collection = currentRequest.collection;
                
                // Update request in Firestore
                await db.collection(collection).doc(currentRequestId).update({
                    status: status,
                    statusNote: note || null,
                    statusUpdatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    statusUpdatedBy: currentUser.uid
                });
                
                // Hide modal
                updateStatusModal.classList.remove('active');
                
                // Show success message
                showToast('Request status updated successfully', 'success');
                
                // Reload data
                if (currentSection === 'dashboard') {
                    loadDashboardData();
                } else if (currentSection === 'appRequests') {
                    loadAppRequests(currentTab);
                } else if (currentSection === 'telegramRequests') {
                    loadTelegramRequests(currentTab);
                } else if (currentSection === 'customRequests') {
                    loadCustomRequests(currentTab);
                }
                
                // Close detail modal if open
                requestDetailModal.classList.remove('active');
            } catch (error) {
                console.error('Error updating request status:', error);
                showToast('Error updating request status', 'error');
            }
        }
        
        // View user details
        async function viewUserDetails(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                
                if (!userDoc.exists) {
                    showToast('User not found', 'error');
                    return;
                }
                
                const userData = userDoc.data();
                
                // Build user details HTML
                const detailsHTML = `
                    <div class="detail-list">
                        <div class="detail-item">
                            <div class="detail-label">User ID</div>
                            <div class="detail-value">${userData.user_id || userId}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">Name</div>
                            <div class="detail-value">${userData.first_name || ''} ${userData.last_name || ''}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">${userData.email || 'Not provided'}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">Phone</div>
                            <div class="detail-value">${userData.phone_number || 'Not provided'}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">Balance</div>
                            <div class="detail-value">₦${userData.balance || '0'}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">Role</div>
                            <div class="detail-value">${userData.role || 'user'}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <button class="btn btn-outline" id="viewUserRequestsBtn">
                            <i class="fas fa-list"></i>
                            View User Requests
                        </button>
                    </div>
                `;
                
                requestDetailContent.innerHTML = detailsHTML;
                
                // Update modal title
                document.querySelector('#requestDetailModal .modal-title').textContent = 'User Details';
                
                // Hide update status button
                updateStatusBtn.style.display = 'none';
                
                // Add event listener to view user requests button
                document.getElementById('viewUserRequestsBtn').addEventListener('click', () => {
                    // Switch to app requests section and filter by user
                    switchSection('appRequests');
                    // TODO: Implement filtering by user
                    requestDetailModal.classList.remove('active');
                });
                
                // Show modal
                requestDetailModal.classList.add('active');
            } catch (error) {
                console.error('Error viewing user details:', error);
                showToast('Error loading user details', 'error');
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Logout button
            logoutBtn.addEventListener('click', handleLogout);
            
            // Sidebar links
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const section = link.dataset.section;
                    switchSection(section);
                });
            });
            
            // Sidebar toggle
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
            
            // Close detail modal
            closeDetailModal.addEventListener('click', () => {
                requestDetailModal.classList.remove('active');
                // Reset modal title
                document.querySelector('#requestDetailModal .modal-title').textContent = 'Request Details';
                // Show update status button
                updateStatusBtn.style.display = 'block';
            });
            
            closeDetailBtn.addEventListener('click', () => {
                requestDetailModal.classList.remove('active');
                // Reset modal title
                document.querySelector('#requestDetailModal .modal-title').textContent = 'Request Details';
                // Show update status button
                updateStatusBtn.style.display = 'block';
            });
            
            // Update status button
            updateStatusBtn.addEventListener('click', () => {
                showUpdateStatusModal(currentRequestId, currentRequest.collection);
            });
            
            // Close status modal
            closeStatusModal.addEventListener('click', () => {
                updateStatusModal.classList.remove('active');
            });
            
            cancelStatusBtn.addEventListener('click', () => {
                updateStatusModal.classList.remove('active');
            });
            
            // Save status button
            saveStatusBtn.addEventListener('click', updateRequestStatus);
            
            // Close contact modal
            closeContactModal.addEventListener('click', () => {
                contactUserModal.classList.remove('active');
            });
            
            closeContactBtn.addEventListener('click', () => {
                contactUserModal.classList.remove('active');
            });
            
            // Refresh button
            refreshRequests.addEventListener('click', () => {
                loadDashboardData();
                showToast('Dashboard refreshed', 'success');
            });
            
            // Save settings button
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            
            // Tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const status = tab.dataset.status;
                    currentTab = status;
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Move tab indicator
                    const tabWidth = tab.offsetWidth;
                    const tabLeft = tab.offsetLeft;
                    tabIndicator.style.width = `${tabWidth}px`;
                    tabIndicator.style.left = `${tabLeft}px`;
                    
                    // Load data based on current section
                    if (currentSection === 'appRequests') {
                        loadAppRequests(status);
                    } else if (currentSection === 'telegramRequests') {
                        loadTelegramRequests(status);
                    } else if (currentSection === 'customRequests') {
                        loadCustomRequests(status);
                    }
                });
            });
            
            // Search inputs
            document.getElementById('appRequestSearch').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                filterAppRequests(searchTerm);
            });
            
            document.getElementById('telegramRequestSearch').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                filterTelegramRequests(searchTerm);
            });
            
            document.getElementById('customRequestSearch').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                filterCustomRequests(searchTerm);
            });
            
            document.getElementById('userSearch').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                filterUsers(searchTerm);
            });
        }
        
        // Handle logout
        async function handleLogout() {
            try {
                await auth.signOut();
                // Redirect to login page
                window.location.href = "/login.html";
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Logout failed: ' + error.message, 'error');
            }
        }
        
        // Switch section
        function switchSection(section) {
            currentSection = section;
            
            // Update active link
            sidebarLinks.forEach(link => {
                if (link.dataset.section === section) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Show active section
            contentSections.forEach(contentSection => {
                if (contentSection.id === section + 'Section') {
                    contentSection.style.display = 'block';
                } else {
                    contentSection.style.display = 'none';
                }
            });
            
            // Load section data
            if (section === 'dashboard') {
                loadDashboardData();
            } else if (section === 'appRequests') {
                loadAppRequests(currentTab);
            } else if (section === 'telegramRequests') {
                loadTelegramRequests(currentTab);
            } else if (section === 'customRequests') {
                loadCustomRequests(currentTab);
            } else if (section === 'users') {
                loadUsers();
            }
            
            // Close sidebar on mobile
            if (window.innerWidth < 992) {
                sidebar.classList.remove('active');
            }
        }
        
        // Filter app requests
        function filterAppRequests(searchTerm) {
            if (!searchTerm) {
                renderAppRequests(appRequests);
                return;
            }
            
            const filteredRequests = appRequests.filter(request => {
                return (
                    (request.appName && request.appName.toLowerCase().includes(searchTerm)) ||
                    (request.fullName && request.fullName.toLowerCase().includes(searchTerm)) ||
                    (request.appDescription && request.appDescription.toLowerCase().includes(searchTerm)) ||
                    (request.id && request.id.toLowerCase().includes(searchTerm))
                );
            });
            
            renderAppRequests(filteredRequests);
        }
        
        // Filter telegram requests
        function filterTelegramRequests(searchTerm) {
            if (!searchTerm) {
                renderTelegramRequests(telegramRequests);
                return;
            }
            
            const filteredRequests = telegramRequests.filter(request => {
                return (
                    (request.telegramBotType && request.telegramBotType.toLowerCase().includes(searchTerm)) ||
                    (request.fullName && request.fullName.toLowerCase().includes(searchTerm)) ||
                    (request.appDescription && request.appDescription.toLowerCase().includes(searchTerm)) ||
                    (request.id && request.id.toLowerCase().includes(searchTerm))
                );
            });
            
            renderTelegramRequests(filteredRequests);
        }
        
        // Filter custom requests
        function filterCustomRequests(searchTerm) {
            if (!searchTerm) {
                renderCustomRequests(customRequests);
                return;
            }
            
            const filteredRequests = customRequests.filter(request => {
                return (
                    (request.title && request.title.toLowerCase().includes(searchTerm)) ||
                    (request.fullName && request.fullName.toLowerCase().includes(searchTerm)) ||
                    (request.name && request.name.toLowerCase().includes(searchTerm)) ||
                    (request.description && request.description.toLowerCase().includes(searchTerm)) ||
                    (request.id && request.id.toLowerCase().includes(searchTerm))
                );
            });
            
            renderCustomRequests(filteredRequests);
        }
        
        // Filter users
        function filterUsers(searchTerm) {
            if (!searchTerm) {
                renderUsers(users);
                return;
            }
            
            const filteredUsers = users.filter(user => {
                return (
                    (user.first_name && user.first_name.toLowerCase().includes(searchTerm)) ||
                    (user.last_name && user.last_name.toLowerCase().includes(searchTerm)) ||
                    (user.email && user.email.toLowerCase().includes(searchTerm)) ||
                    (user.phone_number && user.phone_number.toLowerCase().includes(searchTerm)) ||
                    (user.user_id && user.user_id.toLowerCase().includes(searchTerm))
                );
            });
            
            renderUsers(filteredUsers);
        }
        
        // Save settings
        async function saveSettings() {
            try {
                const adminName = document.getElementById('adminName').value.trim();
                
                if (!currentUser) {
                    showToast('You must be logged in to save settings', 'error');
                    return;
                }
                
                // Update admin document
                await db.collection('admins').doc(currentUser.uid).set({
                    name: adminName,
                    email: currentUser.email,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                // Update display name
                await currentUser.updateProfile({
                    displayName: adminName
                });
                
                // Update UI
                userName.textContent = adminName;
                
                showToast('Settings saved successfully', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Error saving settings', 'error');
            }
        }
        
        // Show toast notification
        function showToast(message, type = 'success') {
            console.log(`Toast (${type}):`, message);
            toastMessage.textContent = message;
            toast.className = 'toast';
            
            if (type === 'error') {
                toast.classList.add('error');
                toastIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
            } else if (type === 'warning') {
                toast.classList.add('warning');
                toastIcon.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
            } else {
                toast.classList.add('success');
                toastIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
            }
            
            // Show toast
            toast.classList.add('show');
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Initialize the app on load
        window.onload = function() {
            // Check if user is already logged in
            const user = auth.currentUser;
            if (user) {
                checkAdminStatus(user);
            }
        };
    </script>
</body>
</html>
